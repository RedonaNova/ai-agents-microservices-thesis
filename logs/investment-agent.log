
> investment-agent@2.0.0 dev
> tsx watch src/index.ts

{"level":"WARN","timestamp":"2025-12-07T14:15:10.890Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
[2025-12-07T14:15:10.892Z] ========================================== 
[2025-12-07T14:15:10.892Z] üöÄ Starting Investment Agent v2.0 
[2025-12-07T14:15:10.892Z] ========================================== 
[2025-12-07T14:15:10.892Z] Connecting to PostgreSQL... 
[2025-12-07T14:15:10.918Z] Connecting to Kafka... 
(node:93387) TimeoutNegativeWarning: -1765116910928 is a negative number.
Timeout duration was set to 1.
(Use `node --trace-warnings ...` to show where the warning was created)
[2025-12-07T14:15:10.938Z] ‚úÖ Investment Agent ready 
[2025-12-07T14:15:10.938Z] Listening for investment tasks... 
[2025-12-07T14:15:10.938Z] ========================================== 
{"level":"INFO","timestamp":"2025-12-07T14:15:10.939Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"investment-agent-group"}
{"level":"INFO","timestamp":"2025-12-07T14:15:13.964Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"investment-agent-group","memberId":"investment-agent-e410ccfc-69aa-404c-ab06-0a745caa1e39","leaderId":"investment-agent-e410ccfc-69aa-404c-ab06-0a745caa1e39","isLeader":true,"memberAssignment":{"agent.tasks":[0,1,2],"execution.plans":[0,1,2]},"groupProtocol":"RoundRobinAssigner","duration":3024}
[2025-12-07T14:17:33.714Z] üì• Processing task {
  "taskId": "1a738686-d472-4b02-8db6-634c55cb0d5b",
  "action": "analyze_watchlist",
  "agentType": "investment"
}
[2025-12-07T14:17:33.715Z] üîç Processing request {
  "action": "analyze_watchlist",
  "symbols": [
    "KHAN-O-0000",
    "MSE-O-0000"
  ],
  "hasContext": true
}
[2025-12-07T14:17:33.744Z] ‚ùå Error fetching MSE data {
  "error": "missing FROM-clause entry for table \"th\""
}
[2025-12-07T14:17:45.972Z] ‚úÖ Response saved to database {
  "requestId": "3052ec79-fb5f-4f9a-8ea1-437e6e7b9c54"
}
[2025-12-07T14:17:45.973Z] ‚úÖ Task completed {
  "taskId": "1a738686-d472-4b02-8db6-634c55cb0d5b",
  "duration": 12259
}
[2025-12-07T14:19:06.153Z] üì• Processing task {
  "taskId": "bf040d22-d7ce-46f5-8163-0ced73194c97",
  "action": "analyze_portfolio",
  "agentType": "investment"
}
[2025-12-07T14:19:06.153Z] üîç Processing request {
  "action": "analyze_portfolio",
  "symbols": [
    "APU-O-0000"
  ],
  "hasContext": true
}
[2025-12-07T14:19:06.181Z] ‚ùå Error fetching MSE data {
  "error": "missing FROM-clause entry for table \"th\""
}
[2025-12-07T14:19:16.262Z] ‚úÖ Response saved to database {
  "requestId": "31987d87-31d2-4a10-b851-b65830d25230"
}
[2025-12-07T14:19:16.262Z] ‚úÖ Task completed {
  "taskId": "bf040d22-d7ce-46f5-8163-0ced73194c97",
  "duration": 10109
}
node:events:486
      throw er; // Unhandled 'error' event
      ^

Error: Connection terminated unexpectedly
    at Connection.<anonymous> (/home/it/apps/thesis-report/backend/investment-agent/node_modules/pg/lib/client.js:136:73)
    at Object.onceWrapper (node:events:622:28)
    at Connection.emit (node:events:508:28)
    at Socket.<anonymous> (/home/it/apps/thesis-report/backend/investment-agent/node_modules/pg/lib/connection.js:62:12)
    at Socket.emit (node:events:508:28)
    at TCP.<anonymous> (node:net:346:12)
Emitted 'error' event on Client instance at:
    at Client._handleErrorEvent (/home/it/apps/thesis-report/backend/investment-agent/node_modules/pg/lib/client.js:350:10)
    at Connection.<anonymous> (/home/it/apps/thesis-report/backend/investment-agent/node_modules/pg/lib/client.js:154:16)
    at Object.onceWrapper (node:events:622:28)
    at Connection.emit (node:events:508:28)
    at Socket.<anonymous> (/home/it/apps/thesis-report/backend/investment-agent/node_modules/pg/lib/connection.js:62:12)
    at Socket.emit (node:events:508:28)
    at TCP.<anonymous> (node:net:346:12)

Node.js v24.11.0
