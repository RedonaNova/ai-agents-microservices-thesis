\chapter{Асуудлын тодорхойлолт ба шийдэл}

Энэхүү бүлэгт олон агентын системийг монолит, микросервис архитектураар нэвтрүүлэхэд тулгарах давуу, сул тал, асуудлуудыг харьцуулан тодорхойлж, EDA ашиглан ухаалаг байдлаар бие даан ажиллах чадвартай олон агент системуудын архитектурын зохиомжийн шийдлийг санал болгоно.

\section{Монолит агентуудын эрсдэл}

Хиймэл оюун хөгжүүлэхэд тогтсон стандарттай фреймворк байдаггүй. Хиймэл оюуны анхны фреймворкууд нь туршилт хийхэд зориулагдсан бөгөөд бизнесийн бодит орчинд зориулагдаагүй байдаг. Хөгжүүлэгчид notebook дээр модел туршиж, тодорхой хязгаарлагдмал ажлын урсгалыг ажиллуулж байсан. Гэвч бодит орчинд агентууд нь notebook-д амьдрах нь зохимжгүй. Жишээлбэл өгөгдөл нь хуучрах, өөр дэд процессийн үйл ажиллагаа өөрчлөгдвөл алдаа гарах, нэг газар унавал алдаа барихад хэцүү зэрэг асуудал тулгарсан. Тиймээс агентууд бодит орчинд ажиллаж, бизнесийн үйл ажиллагаатай интеграц хийж, найдвартайгаар өргөжих шаардлагатай байдаг.  

\subsection{Нягт холбогдсон монолит агентуудын архитектур}

Монолит агентын систем нь бүх агентууд нэг аппликейшн доторх модуль эсвэл класс болж ажилладаг. Хэрэглэгч Orchestrator агент руу хүсэлт илгээхэд Orchestrator нь бусад агентуудыг API-аар дуудах ба агентууд хоорондоо NxM нягт холбоостой байдаг. Энэ нь хялбар харагдах ч хэд хэдэн ноцтой асуудал үүсгэдэг.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{figures/agentMonolith.png}
    \caption{Монолит агентын архитектур: NxM нягт холбоос}
    \label{fig:monolith-agent}
\end{figure}

Монолит агентын системийн дараах сул талуудтай байна. Агентууд бие биенээсээ шууд хамааралтай байдаг учир нэг агентын өөрчлөлт нь бусад агентуудад нөлөөлдөг. Бүх агентууд нэгэн зэрэг өргөжих ёстой бөгөөд тусдаа өргөжүүлэх боломжгүй тул өргөжүүлэх хүндрэлтэй байдал үүсдэг. Нэг агентыг шинэчлэхэд бүх системийг дахин суурилуулах шаардлагатай тул хөгжүүлэлтийн багууд бие биенийгээ хүлээж бизнесийн үйл ажиллагаа удаашрах эрсдэлтэй. Бүх агентууд нэг серверийн нөөцийг хуваалцдаг, иймээс олон хүсэлт даахад бэрхшээлтэй болно. Нэг кодын сан дээр ажиллах нь зөрчил, удаашралыг үүсгэдэг зэрэг эрсдэл байдаг.

Нэг агент унах нь бүх системийг доголдох магадлалтай. Жишээлбэл, Knowledge Agent унавал Orchestrator түүнээс хүлээж байдаг учир бусад хүсэлтүүд боловсруулагдахгүй. Энэ нь монолит агентын хамгийн том эрсдэл болох дамжин унах алдаа юм.

\section{Микросервис агентуудын шийдэл}

Эдгээр асуудлыг шийдэхийн тулд микросервис архитектурт ашигладаг EDA нь хиймэл оюуны найдвартай нэвтрүүлэлтийн аргачлал болдог. NxM нягт холбоосын оронд агентууд эвент брокероор дамжуулан бие биетэйгээ брокерийн мессежээр харилцдаг. Энэ нь хамааралыг N+M болгон бууруулж, агентуудыг бүрэн салангид болгодог. 

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{figures/agentMicroservice.png}
    \caption{Үйл явдлаар удирдагдах олон агентын систем}
    \label{fig:event-driven-agents}
\end{figure}

Үйл явдлаар удирдагдах агентын систем нь гурван гол бүрэлдэхүүнтэй. Эвент үүсгэгчүүд нь өөр өөр зориулалттай агентууд (Төлөвлөгч, чиглүүлэгч, мэдээ,, төлбөр тооцооны гэх мэт) үйл явдал үүсгэж эвент брокер руу илгээдэг. Apache Kafka, RabbitMQ зэрэг эвент брокер нь агентуудын хоорондын төв мэдрэгч систем болж үйл явдлыг хадгалж агентууд өөр өөрдийгөө рекурсив байдлаар дуудах боломжийг нээдэг. Эвент хүлээн авагч хэсэг нь агентууд өөрсдөө ба брокерийн гаргаж буй үйл явдлыг хүлээн авч боловсруулна. Үүнд агентын хэрэглүүрүүд (жишээ нь цаг агаарын мэдээ авах, нэхэмжлэл үүсгэх..), систем интеграци, лог болон шинжилгээ, бусад агент руу чиглүүлэх зэрэг багтдаг.

Энэхүү архитектур нь монолит системийн бүх сул талыг шийддэг. Салангид байдлын хувьд агентууд эвент брокероор харилцах тул бие биенээсээ хараат бус байдаг. Нэг агент унах нь бусдад шууд нөлөөлөхгүй. Хэрэглүүр, системтэй холбогдсон байдал нь хуучраагүй бодит цагийн өгөгдөл авах зэрэг боломж нээдэг. Асинхрон харилцааны хувьд агентууд бие биенийхээ хариуг хүлээхгүй, параллель боловсруулалт хийх боломжтой. Бие даан өргөжүүлэх чадварын хувьд агент бүр өөрийн цар хүрээний хэрэгцээний тохирсон хэмжээгээр өргөжиж болно. Байршуулалтын салангид байдлын хувьд агент бүрийг бусдад нөлөөлөхгүйгээр тусдаа суурилуулж болно. Найдвартай байдлын хувьд үйл явдлууд хадгалдаг учир агент түр зуур унасан ч мэдээлэл алдагдахгүй, дахин ачааллуулж болно. Иймээс ч бүх үйл явдал лог байдлаар хадгалагдах учир алдаа олж засах, тест хийх, аудит хийж чадна.

\subsection{Микросервист суурилсан хиймэл оюун агентуудын зохиомжийн жишээ}

Энэ судалгааны ажлын санал болгож буй микросервист суурилсан хиймэл оюуны агентууд дараах байдлаар ажиллана. Хэрэглэгч фронтенд дээр хүсэлт илгээнэ. API Gateway хүсэлтийг хүлээн авч Kafka сэдэв рүү үйл явдэл болгон илгээнэ. Зохион байгуулагч агент үйл явдлыг хүлээн авч суурь модел эсвэл жижиг GPT-2 зэрэг моделоор хүсэлтийг ангилна. Ангилласны дараа олон агентуудын мэдээллийг агуулж буй RAG-аас аль агент руу чиглүүлэхийг заана. Мөн Apache Flink ашиглан нарийн төвөгтэй төлөвлөлт хийх, хиймэл оюуны боловсруулсан мэдээллийг нэгтгэж болдог. Зохион байгуулагч агент нь эцэст нь уг нэгтгэсэн хариуг хянаж тохирох агент, эсвэл хэрэглэгч рүү хариу илгээж болно.

Хортой зааврыг урьдчилсан сэргийлэхийн тулд уг хүсэлтийг боловсруулж ангилаад хэрэглэгчдэд хүргэхээс өмнө хааж болно. Мөн эцсийн боловсруулсан гаралтыг бас хянаад хааж болдог.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{figures/charMicroservice.png}
    \caption{Бодит хэрэгжүүлсэн архитектур: Kafka-Flink суурилсан олон агентын систем}
    \label{fig:actual-architecture}
\end{figure}

Өөр өөр зориулттай агентууд өөрсдийн үүргийг гүйцэтгэдэг. Knowledge Agent буюу мэдлэгийн агент RAG нь бусад агент, чадавхын мэдээлэл агуулах ба уг агентийг ашиглан хүсэлтийг хаашаа чиглүүлж болох талаар хайж шийдвэр гаргана. Мэдээллийн агент нь өөрсдийн хандах боломжтой орчноос хэрэглүүрийн тусламжтай мэдээлэл цуглуулна. Төлбөр тооцооны агент нь гүйлгээ боловсруулах зэрэг үйлдэл хийнэ. Хэрэглэгчийн агент нь хэрэглэгчийн мэдээлэлтэй ажилладаг. Агентууд үр дүнгээ Kafka сэдэв рүү буцааж илгээнэ.

Зарим тохиолдолд агентууд рекурсив байдлаар зохион байгуулагч агент руу дахин хандаж нэмэлт мэдээлэл авч болно. Энэ нь нарийн төвөгтэй олон алхамт даалгаврыг шийдэх боломжийг олгодог. Жишээлбэл хэрэглэгчийн мэдээллийг авч, түүний төлбөр тооцооны мэдээг өөр агентаас авч нэгтгэж болно. Эцэст нь API Gateway нь хариултыг хүлээн авч хэрэглэгчид SSE (Server-Sent Events) ашиглан бодит цагийн stream хэлбэрээр хүргэнэ.

Энэхүү архитектур нь дараах давуу талуудтай. Агент бүр бие даан параллелаар ажиллаж, мянга мянган хүсэлтийг боловсруулна. Шинэ агент нэмэх нь бусад агентын кодыг өөрчлөхгүй. Бодит цагийн шийдвэр гаргалтын хувьд хатуу кодлогдсон процессийн урсгал биш, хиймэл оюун динамикаар дараагийн алхмыг тодорхойлдог. Kafka нь лог хадгалах учраас бүх үйл явдал хадгалагдаж, үнэлгээ, дахин сургалтад ашиглаж болно. Агент бүрийн үйл явдал хадгалагдаж, олон шатлалт хянаж, шинжилгээ хийх боломжтой болно.

Энэ бол хиймэл оюун системийн шинэ фреймворк ба харин найдвартай, өргөжих чадвартай, бүрэн салангид байж чадах учраас шинэ стандарт болох боломжтой юм.

\input{src/similar-systems}

\section{Бүлгийн дүгнэлт}

Энэхүү бүлэгт олон агентын системийг монолит болон микросервис архитектураар нэвтрүүлэхэд тулгарах асуудлуудыг тодорхойлж, үйл явдлаар удирдагдах архитектур ашиглан салангид, өргөжих боломжтой систем бүтээх шийдлийг санал болголоо.

Монолит агентын гол асуудлууд нь агентийн тоогоор NxM нягт холбоос үүссэнээр өргөжүүлэх хүндэрч, цаашлаад дамжин унах алдаа, хөгжүүлэлтийн удаашрал зэргийг үүсгэдэг. Эдгээр асуудлыг шийдэхийн тулд микросервис архитектурт EDA ашигласнаар агентууд бие биенээсээ салангид, асинхрон байдлаар найдвартай байдлаар ажиллах боломжтой болно. Inngest, Temporal, Camunda зэрэг одоо байгаа системүүдтэй харьцуулахад энэхүү судалгааны санал болгож буй зохиомж нь анхнаасаа хиймэл оюун агентуудыг салангид микросервис болгон хөгжүүлж, Kafka-Flink ашиглан бодит цагийн урсгал боловсруулалт хийж, нээлттэй эх суурилсан технологи ашиглаж, хэвтээгээр өргөжих зэрэг онцлогтой.

Уг судалгааны ажлын технологийн архитектур нь Apache Kafka-г агентуудын мэдээлэл солилцох суваг болгон ашиглаж салангид байдлыг хангаж, асинхрон харилцаагаар хүлээлт үүсгэхгүй, олон хэрэглэгч дэмжих, найдвартай байдлыг хангах, алдаатай хүсэлтийг дахин ачааллуулах зэрэг үйлдлүүдийг EDA-ын тусламжтайгаар хэрэгжүүлнэ. Энэ архитектурын зохиомж нь бие даасан ухаалаг микросервис болгон хөгжүүлэх боломжийг олгоно. 