
> api-gateway@1.0.0 dev
> tsx watch src/index.ts

[32minfo[39m: Starting API Gateway... {"env":"development","port":3001,"service":"api-gateway","timestamp":"2025-11-08T09:51:48.457Z"}
[32minfo[39m: Connected to MongoDB {"service":"api-gateway","timestamp":"2025-11-08T09:51:50.580Z","uri":"mongodb://localhost:27017/thesis-db"}
{"level":"WARN","timestamp":"2025-11-08T09:51:50.584Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
{"level":"ERROR","timestamp":"2025-11-08T09:51:50.609Z","logger":"kafkajs","message":"[BrokerPool] Closed connection","retryCount":0,"retryTime":86}
{"level":"ERROR","timestamp":"2025-11-08T09:51:50.699Z","logger":"kafkajs","message":"[BrokerPool] Closed connection","retryCount":1,"retryTime":206}
{"level":"ERROR","timestamp":"2025-11-08T09:51:50.909Z","logger":"kafkajs","message":"[BrokerPool] Closed connection","retryCount":2,"retryTime":332}
{"level":"ERROR","timestamp":"2025-11-08T09:51:51.246Z","logger":"kafkajs","message":"[Connection] Connection error: read ECONNRESET","broker":"localhost:9092","clientId":"api-gateway","stack":"Error: read ECONNRESET\n    at TCP.onStreamRead (node:internal/stream_base_commons:216:20)"}
{"level":"ERROR","timestamp":"2025-11-08T09:51:51.247Z","logger":"kafkajs","message":"[BrokerPool] Failed to connect to seed broker, trying another broker from the list: Connection error: read ECONNRESET","retryCount":3,"retryTime":728}
{"level":"ERROR","timestamp":"2025-11-08T09:51:51.979Z","logger":"kafkajs","message":"[BrokerPool] Closed connection","retryCount":4,"retryTime":1732}
{"level":"ERROR","timestamp":"2025-11-08T09:51:53.719Z","logger":"kafkajs","message":"[Connection] Connection error: read ECONNRESET","broker":"localhost:9092","clientId":"api-gateway","stack":"Error: read ECONNRESET\n    at TCP.onStreamRead (node:internal/stream_base_commons:216:20)"}
{"level":"ERROR","timestamp":"2025-11-08T09:51:53.724Z","logger":"kafkajs","message":"[BrokerPool] Failed to connect to seed broker, trying another broker from the list: Connection error: read ECONNRESET","retryCount":5,"retryTime":3490}
{"level":"ERROR","timestamp":"2025-11-08T09:51:54.897Z","logger":"kafkajs","message":"[Connection] Connection error: read ECONNRESET","broker":"localhost:9092","clientId":"api-gateway","stack":"Error: read ECONNRESET\n    at TCP.onStreamRead (node:internal/stream_base_commons:216:20)"}
{"level":"ERROR","timestamp":"2025-11-08T09:51:54.898Z","logger":"kafkajs","message":"[BrokerPool] Failed to connect to seed broker, trying another broker from the list: Connection error: read ECONNRESET","retryCount":6,"retryTime":6726}
{"level":"ERROR","timestamp":"2025-11-08T09:52:01.625Z","logger":"kafkajs","message":"[Connection] Connection error: connect ECONNREFUSED 127.0.0.1:9092","broker":"localhost:9092","clientId":"api-gateway","stack":"Error: connect ECONNREFUSED 127.0.0.1:9092\n    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1637:16)"}
{"level":"ERROR","timestamp":"2025-11-08T09:52:01.626Z","logger":"kafkajs","message":"[BrokerPool] Failed to connect to seed broker, trying another broker from the list: Connection error: connect ECONNREFUSED 127.0.0.1:9092","retryCount":7,"retryTime":14080}
(node:94328) TimeoutNegativeWarning: -1762595535713 is a negative number.
Timeout duration was set to 1.
(Use `node --trace-warnings ...` to show where the warning was created)
[32minfo[39m: Kafka producer connected {"service":"api-gateway","timestamp":"2025-11-08T09:52:15.713Z"}
[32minfo[39m: API Gateway listening on port 3001 {"service":"api-gateway","timestamp":"2025-11-08T09:52:15.716Z"}
[32minfo[39m: CORS enabled for: http://localhost:3000 {"service":"api-gateway","timestamp":"2025-11-08T09:52:15.717Z"}
[32minfo[39m: Kafka broker: localhost:9092 {"service":"api-gateway","timestamp":"2025-11-08T09:52:15.717Z"}
[32minfo[39m: API Gateway is ready! {"service":"api-gateway","timestamp":"2025-11-08T09:52:15.717Z"}
[32minfo[39m: GET /health {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:52:16.940Z","userAgent":"curl/8.5.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:53:43.968Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:53:43.986Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:53:47.033Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:53:52.453Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:53:57.880Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:54:03.604Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:54:03.611Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: POST /api/agent/investment/portfolio/advice {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:54:10.387Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:56:21.678Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T09:56:21.690Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: POST /api/agent/portfolio/advice {"ip":"::ffff:127.0.0.1","service":"api-gateway","timestamp":"2025-11-08T09:56:30.672Z","userAgent":"node"}
[32minfo[39m: Event sent to portfolio-requests {"key":"ddbe379a-3227-47b4-9562-42031f015cfd","service":"api-gateway","timestamp":"2025-11-08T09:56:30.734Z"}
[32minfo[39m: Portfolio advice request sent (consolidated) {"requestId":"ddbe379a-3227-47b4-9562-42031f015cfd","service":"api-gateway","timestamp":"2025-11-08T09:56:30.735Z","userId":"watchlist-user"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T10:14:55.851Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T10:14:55.875Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: POST /api/agent/investment/portfolio/advice {"ip":"::1","service":"api-gateway","timestamp":"2025-11-08T10:15:00.853Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-09T12:04:44.241Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: GET /api/monitoring/agents {"ip":"::1","service":"api-gateway","timestamp":"2025-11-09T12:04:44.327Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
[32minfo[39m: POST /api/agent/investment/portfolio/advice {"ip":"::1","service":"api-gateway","timestamp":"2025-11-09T12:04:50.527Z","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"}
